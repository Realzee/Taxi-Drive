<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - TaxiDrive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style type="text/css">@font-face {font-family:Montserrat;font-style:normal;font-weight:400;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:400;src:url(/cf-fonts/v/montserrat/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:400;src:url(/cf-fonts/v/montserrat/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:400;src:url(/cf-fonts/v/montserrat/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:400;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:500;src:url(/cf-fonts/v/montserrat/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:500;src:url(/cf-fonts/v/montserrat/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:500;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:500;src:url(/cf-fonts/v/montserrat/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:500;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:600;src:url(/cf-fonts/v/montserrat/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:600;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:600;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:600;src:url(/cf-fonts/v/montserrat/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:600;src:url(/cf-fonts/v/montserrat/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:700;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:700;src:url(/cf-fonts/v/montserrat/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:700;src:url(/cf-fonts/v/montserrat/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:700;src:url(/cf-fonts/v/montserrat/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Montserrat;font-style:normal;font-weight:700;src:url(/cf-fonts/v/montserrat/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}</style>
    <link rel="icon" href="./assets/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./css/style.css">
    <!-- Ensure style.css includes modal styles as described in the previous response -->
</head>
<body>
    <div class="container">
        <div class="logo">
            <img src="./assets/Logo1.png" alt="TaxiDrive Logo">
        </div>
        <h1>Login</h1>

        <!-- Toggle between Login and Signup -->
        <div class="toggle-buttons">
            <button type="button" id="login-tab" class="btn btn-primary active">Login</button>
            <button type="button" id="signup-tab" class="btn btn-primary">Sign Up</button>
        </div>

        <!-- Login Form -->
        <form id="login-form" style="display: block;">
            <div class="form-group role-select">
                <label class="form-label">Login As</label>
                <select id="login-role" class="form-input" required>
                    <option value="">Select Role</option>
                    <option value="passenger">Passenger</option>
                    <option value="driver">Driver</option>
                    <option value="owner">Owner</option>
                    <option value="association">Association</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" required placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="login-password" required placeholder="Enter your password">
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
            <div id="login-error-message" class="error"></div>
        </form>
    </div>

    <!-- Sign Up Role Selection Modal -->
    <div id="signup-role-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Select Role</h2>
            <p>Please choose the type of account you want to create:</p>
            <div class="form-group">
                <button class="btn btn-primary signup-role-btn" data-role="association">Association</button>
                <button class="btn btn-primary signup-role-btn" data-role="driver">Driver</button>
                <button class="btn btn-primary signup-role-btn" data-role="owner">Owner</button>
                <button class="btn btn-primary signup-role-btn" data-role="passenger">Passenger</button>
            </div>
            <button id="signup-role-cancel" class="modal-close-btn" data-modal="signup-role-modal">Cancel</button>
        </div>
    </div>

    <!-- Confirmation / Error Modal -->
    <div id="signup-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-title">Success!</h2>
            <p id="modal-message">Account created successfully</p>
            <p id="modal-login-details"></p>
            <button id="modal-close-btn" class="modal-close-btn" data-modal="signup-modal">Close</button>
        </div>
    </div>

    <!-- Passenger Signup Modal -->
    <div id="signup-passenger-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Passenger Signup</h3>
            <form id="signup-passenger">
                <div class="form-group">
                    <label for="passenger-email">Email</label>
                    <input type="email" id="passenger-email" class="form-input" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="passenger-password">Password</label>
                    <input type="password" id="passenger-password" class="form-input" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary">Register Passenger</button>
                <div id="signup-passenger-error-message" class="error"></div>
            </form>
            <button class="modal-close-btn" data-modal="signup-passenger-modal">Close</button>
        </div>
    </div>

    <!-- Driver Signup Modal -->
    <div id="signup-driver-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Driver Signup</h3>
            <form id="signup-driver">
                <div class="form-group">
                    <label for="driver-email">Email</label>
                    <input type="email" id="driver-email" class="form-input" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="driver-password">Password</label>
                    <input type="password" id="driver-password" class="form-input" required placeholder="Enter your password">
                </div>
                <div class="form-group">
                    <label for="driver-license-number">License Number</label>
                    <input type="text" id="driver-license-number" class="form-input" required placeholder="Enter your license number">
                </div>
                <button type="submit" class="btn btn-primary">Register Driver</button>
                <div id="signup-driver-error-message" class="error"></div>
            </form>
            <button class="modal-close-btn" data-modal="signup-driver-modal">Close</button>
        </div>
    </div>

    <!-- Owner Signup Modal -->
    <div id="signup-owner-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Owner Signup</h3>
            <form id="signup-owner">
                <div class="form-group">
                    <label for="owner-email">Email</label>
                    <input type="email" id="owner-email" class="form-input" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="owner-password">Password</label>
                    <input type="password" id="owner-password" class="form-input" required placeholder="Enter your password">
                </div>
                <div class="form-group">
                    <label for="owner-company-name">Company Name</label>
                    <input type="text" id="owner-company-name" class="form-input" required placeholder="Enter company name">
                </div>
                <button type="submit" class="btn btn-primary">Register Owner</button>
                <div id="signup-owner-error-message" class="error"></div>
            </form>
            <button class="modal-close-btn" data-modal="signup-owner-modal">Close</button>
        </div>
    </div>

    <!-- Association Signup Modal -->
    <div id="signup-association-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Association Signup</h3>
            <form id="signup-association">
                <!-- Association Information Section -->
                <div class="form-group">
                    <h4><i class="fas fa-info-circle"></i> Association Information</h4>
                    <label for="association-name">Association Name *</label>
                    <input type="text" id="association-name" name="name" class="form-input" required placeholder="Enter association name">
                    <small>This will be displayed throughout the system</small>
                    <label for="association-email">Email Address *</label>
                    <input type="email" id="association-email" name="email" class="form-input" required placeholder="Enter association email">
                    <small>Used for notifications and communications</small>
                    <label for="association-phone">Phone Number *</label>
                    <input type="tel" id="association-phone" name="phone" class="form-input" required placeholder="Enter phone number">
                    <small>Primary contact number</small>
                    <label for="association-registration-number">Registration Number</label>
                    <input type="text" id="association-registration-number" name="registrationNumber" class="form-input" placeholder="Enter registration number">
                    <small>Official registration number (optional)</small>
                    <label for="association-address">Physical Address *</label>
                    <textarea id="association-address" name="address" class="form-input" required rows="3" placeholder="Enter complete physical address"></textarea>
                    <small>Street address, city, province, postal code</small>
                    <label for="association-description">Description</label>
                    <textarea id="association-description" name="description" class="form-input" rows="3" placeholder="Brief description of your association"></textarea>
                    <small>Tell us about your association's mission and services</small>
                </div>
                <!-- Logo Upload Section -->
                <div class="form-group">
                    <h4><i class="fas fa-image"></i> Association Logo</h4>
                    <label for="association-logo">Upload Logo</label>
                    <input type="file" id="association-logo" name="logo" class="form-input" accept=".jpg,.jpeg,.png,.gif,.svg">
                    <small>Accepted formats: JPG, PNG, GIF, SVG (Max 2MB)</small>
                    <div id="logo-preview-container" style="display: none; text-align: center;">
                        <div class="logo-preview">
                            <img id="logo-preview-img" src="" alt="Logo Preview" style="max-width: 150px; max-height: 150px; border-radius: 12px;">
                            <div>
                                <button type="button" id="remove-logo-btn" class="btn btn-danger btn-sm">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                                <span id="logo-info"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Login Information Section -->
                <div class="form-group">
                    <h4><i class="fas fa-user-shield"></i> Login Information</h4>
                    <label for="admin-email">Administrator Email *</label>
                    <input type="email" id="admin-email" name="adminEmail" class="form-input" required placeholder="Enter administrator email">
                    <small>This will be the login email for the administrator</small>
                    <label for="admin-password">Administrator Password *</label>
                    <input type="password" id="admin-password" name="adminPassword" class="form-input" required placeholder="Enter administrator password">
                    <small>Password must be at least 8 characters long</small>
                </div>
                <!-- Administrator Information Section -->
                <div class="form-group">
                    <h4><i class="fas fa-user"></i> Administrator Information</h4>
                    <label for="admin-name">Administrator Name *</label>
                    <input type="text" id="admin-name" name="adminName" class="form-input" required placeholder="Enter administrator name">
                    <small>Full name of the association administrator</small>
                    <label for="admin-phone">Administrator Phone *</label>
                    <input type="tel" id="admin-phone" name="adminPhone" class="form-input" required placeholder="Enter administrator phone">
                    <small>Contact number for the administrator</small>
                    <label for="admin-id-number">Administrator ID Number *</label>
                    <input type="text" id="admin-id-number" name="adminIdNumber" class="form-input" required placeholder="Enter administrator ID number">
                    <small>Official ID number for verification</small>
                </div>
                <!-- Terms and Conditions -->
                <div class="form-group">
                    <h4><i class="fas fa-clipboard-list"></i> Terms and Conditions</h4>
                    <div class="terms-container">
                        <p>By registering this association, you agree to:</p>
                        <ul>
                            <li>Provide accurate and truthful information</li>
                            <li>Comply with all applicable taxi industry regulations</li>
                            <li>Maintain proper licensing and insurance requirements</li>
                            <li>Ensure all member owners are properly registered and licensed</li>
                            <li>Use the system responsibly and in accordance with the terms of service</li>
                            <li>Protect user data and maintain confidentiality</li>
                        </ul>
                        <p>The administrator will receive login credentials and be responsible for managing the association's account and member owners.</p>
                        <label>
                            <input type="checkbox" id="terms-accepted" name="termsAccepted" required>
                            I have read and agree to the terms and conditions. I confirm that all information provided is accurate and I have the authority to register this association.
                        </label>
                    </div>
                </div>
                <!-- Registration Progress -->
                <div id="signup-progress" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div id="signup-progress-bar"></div>
                        </div>
                        <div class="progress-text">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span id="signup-progress-text">Preparing registration...</span>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" id="submit-signup">
                    <i class="fas fa-building"></i> Register Association
                </button>
                <div id="signup-association-error-message" class="error"></div>
            </form>
            <button class="modal-close-btn" data-modal="signup-association-modal">Close</button>
        </div>
    </div>

    <!-- External Supabase Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="./js/supabase-services.js" defer></script>
    <script src="./js/script.js" defer></script>

    <!-- Error Handling and Debugging Script -->
    <script>
        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.message || e.error || 'Unknown error');
            console.error('Error occurred at:', e.filename || 'unknown file', 'line:', e.lineno || 'unknown', 'column:', e.colno || 'unknown');
            e.preventDefault();
        }, true);

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled Promise Rejection:', e.reason || 'Unknown reason');
            e.preventDefault();
        });

        // Page load debugging
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded successfully at:', new Date().toLocaleString());

            const container = document.querySelector('.container');
            const logo = document.querySelector('.logo img');
            const loginForm = document.getElementById('login-form');
            const signupAssociationModal = document.getElementById('signup-association-modal');

            console.log('Container visibility:', getComputedStyle(container).display);
            console.log('Logo visibility:', getComputedStyle(logo).display);
            console.log('Login form visibility:', loginForm ? getComputedStyle(loginForm).display : 'NOT FOUND');
            console.log('Signup association modal visibility:', signupAssociationModal ? getComputedStyle(signupAssociationModal).display : 'NOT FOUND');

            if (logo) {
                logo.addEventListener('error', function() {
                    console.warn('Logo image failed to load, using fallback');
                    this.style.display = 'none';
                });

                logo.addEventListener('load', function() {
                    console.log('Logo image loaded successfully');
                });
            }

            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');

            console.log('Form toggle buttons found:', loginTab && signupTab ? 'Yes' : 'No');
        });

        // Debug modal visibility
        function debugModals() {
            const modals = [
                'signup-role-modal',
                'signup-passenger-modal',
                'signup-driver-modal',
                'signup-owner-modal',
                'signup-association-modal',
                'signup-modal'
            ];
            modals.forEach(id => {
                const modal = document.getElementById(id);
                console.log(`${id}:`, modal ? getComputedStyle(modal).display : 'NOT FOUND');
            });
            const loginForm = document.getElementById('login-form');
            console.log('Login form:', loginForm ? getComputedStyle(loginForm).display : 'NOT FOUND');
        }

        window.debugModals = debugModals;

        // Check function availability
        function checkFunctionAvailability() {
            console.log('🔍 Checking function availability...');
            console.log('signupAssociation:', typeof signupAssociation);
            console.log('login:', typeof login);
            console.log('signupSimple:', typeof signupSimple);
            console.log('showModal:', typeof showModal);
            console.log('closeAllModals:', typeof closeAllModals);
        }

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkFunctionAvailability, 2000);
        });
    </script>
</body>
</html>